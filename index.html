<script type="module">
  import { WebR } from "https://webr.r-wasm.org/latest/webr.mjs";

  const webR = new WebR();
  const resultArea = document.getElementById("result");
  const runBtn = document.getElementById("runBtn");
  const canvas = document.getElementById("webr-canvas");

  resultArea.textContent = "WebR を読み込み中です…";

  // WebR 初期化
  await webR.init();

  resultArea.textContent = "ここに結果が表示されます";

  runBtn.addEventListener("click", async () => {
    const code = document.getElementById("rcode").value.trim();

    if (!code) {
      resultArea.textContent = "Rコードが入力されていません。";
      return;
    }

    resultArea.textContent = "実行中です…";

    try {
      // Rコードを実行
      const rResult = await webR.evalR(code);

      // Rのコンソール出力を取得
      const consoleText = await rResult.toConsole();

      resultArea.textContent =
        consoleText && consoleText.trim() !== ""
          ? consoleText
          : "Rからの出力はありませんでした。";

    } catch (error) {
      resultArea.textContent = "エラーが発生しました: " + error.message;
    }
  });
</script>
